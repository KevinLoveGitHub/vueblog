<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Flask | weigao</title>
    <meta name="description" content="...">
    <link rel="icon" href="/android-chrome-512x512.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.e8d92be3.css" as="style"><link rel="preload" href="/assets/js/app.5b882d21.js" as="script"><link rel="preload" href="/assets/js/5.cd1db3e5.js" as="script"><link rel="preload" href="/assets/js/57.81a8354f.js" as="script"><link rel="preload" href="/assets/js/23.2c687b63.js" as="script"><link rel="prefetch" href="/assets/js/1.61fa752c.js"><link rel="prefetch" href="/assets/js/10.d0a7f483.js"><link rel="prefetch" href="/assets/js/100.c3c38b3f.js"><link rel="prefetch" href="/assets/js/101.ba47a8ea.js"><link rel="prefetch" href="/assets/js/11.40e90e2e.js"><link rel="prefetch" href="/assets/js/12.59472db4.js"><link rel="prefetch" href="/assets/js/13.82dc035e.js"><link rel="prefetch" href="/assets/js/14.3f854a99.js"><link rel="prefetch" href="/assets/js/15.27ecaa65.js"><link rel="prefetch" href="/assets/js/16.7269e8f3.js"><link rel="prefetch" href="/assets/js/17.1baed97f.js"><link rel="prefetch" href="/assets/js/18.337eab3d.js"><link rel="prefetch" href="/assets/js/19.7441a7d8.js"><link rel="prefetch" href="/assets/js/2.abd16662.js"><link rel="prefetch" href="/assets/js/20.3a5f087d.js"><link rel="prefetch" href="/assets/js/21.48fc9301.js"><link rel="prefetch" href="/assets/js/22.82d214b6.js"><link rel="prefetch" href="/assets/js/24.fa6e8fb7.js"><link rel="prefetch" href="/assets/js/25.738cedaa.js"><link rel="prefetch" href="/assets/js/26.c5def0f6.js"><link rel="prefetch" href="/assets/js/27.dc9cdb49.js"><link rel="prefetch" href="/assets/js/28.101b6314.js"><link rel="prefetch" href="/assets/js/29.abf7f7b1.js"><link rel="prefetch" href="/assets/js/30.0629d4d9.js"><link rel="prefetch" href="/assets/js/31.92736f25.js"><link rel="prefetch" href="/assets/js/32.503a383b.js"><link rel="prefetch" href="/assets/js/33.d700f59d.js"><link rel="prefetch" href="/assets/js/34.5304a9af.js"><link rel="prefetch" href="/assets/js/35.ab6a77a1.js"><link rel="prefetch" href="/assets/js/36.603e9dd9.js"><link rel="prefetch" href="/assets/js/37.e89bdebe.js"><link rel="prefetch" href="/assets/js/38.1f73a8c6.js"><link rel="prefetch" href="/assets/js/39.322980cc.js"><link rel="prefetch" href="/assets/js/4.20b55e5f.js"><link rel="prefetch" href="/assets/js/40.4ca46d73.js"><link rel="prefetch" href="/assets/js/41.ff17cbd8.js"><link rel="prefetch" href="/assets/js/42.b93980ad.js"><link rel="prefetch" href="/assets/js/43.625374e9.js"><link rel="prefetch" href="/assets/js/44.1f8b8410.js"><link rel="prefetch" href="/assets/js/45.6b685468.js"><link rel="prefetch" href="/assets/js/46.b1e427dc.js"><link rel="prefetch" href="/assets/js/47.1105348d.js"><link rel="prefetch" href="/assets/js/48.f20ef025.js"><link rel="prefetch" href="/assets/js/49.5b0ccec3.js"><link rel="prefetch" href="/assets/js/50.0d742578.js"><link rel="prefetch" href="/assets/js/51.759bde75.js"><link rel="prefetch" href="/assets/js/52.e961fe01.js"><link rel="prefetch" href="/assets/js/53.cfc3464d.js"><link rel="prefetch" href="/assets/js/54.3add5986.js"><link rel="prefetch" href="/assets/js/55.113f6510.js"><link rel="prefetch" href="/assets/js/56.647d3fbf.js"><link rel="prefetch" href="/assets/js/58.ac99e744.js"><link rel="prefetch" href="/assets/js/59.e3bb8a78.js"><link rel="prefetch" href="/assets/js/6.46455cb0.js"><link rel="prefetch" href="/assets/js/60.76f1be0c.js"><link rel="prefetch" href="/assets/js/61.547bf157.js"><link rel="prefetch" href="/assets/js/62.bb2d5f35.js"><link rel="prefetch" href="/assets/js/63.1d014a02.js"><link rel="prefetch" href="/assets/js/64.26d8c9ff.js"><link rel="prefetch" href="/assets/js/65.79722d0a.js"><link rel="prefetch" href="/assets/js/66.60e32eb8.js"><link rel="prefetch" href="/assets/js/67.e94e5af8.js"><link rel="prefetch" href="/assets/js/68.0c62bc2d.js"><link rel="prefetch" href="/assets/js/69.35a9527f.js"><link rel="prefetch" href="/assets/js/7.64614a42.js"><link rel="prefetch" href="/assets/js/70.48adc3c5.js"><link rel="prefetch" href="/assets/js/71.bc9001ba.js"><link rel="prefetch" href="/assets/js/72.677442bb.js"><link rel="prefetch" href="/assets/js/73.5e19868d.js"><link rel="prefetch" href="/assets/js/74.9b41ca8d.js"><link rel="prefetch" href="/assets/js/75.66697b03.js"><link rel="prefetch" href="/assets/js/76.b8a63a09.js"><link rel="prefetch" href="/assets/js/77.5bd5aa5a.js"><link rel="prefetch" href="/assets/js/78.26da0d5f.js"><link rel="prefetch" href="/assets/js/79.5012579e.js"><link rel="prefetch" href="/assets/js/8.11937928.js"><link rel="prefetch" href="/assets/js/80.9042b852.js"><link rel="prefetch" href="/assets/js/81.f18600b7.js"><link rel="prefetch" href="/assets/js/82.81cf8d7b.js"><link rel="prefetch" href="/assets/js/83.368be746.js"><link rel="prefetch" href="/assets/js/84.0ad20007.js"><link rel="prefetch" href="/assets/js/85.bed6c2b0.js"><link rel="prefetch" href="/assets/js/86.a567014d.js"><link rel="prefetch" href="/assets/js/87.9001eb19.js"><link rel="prefetch" href="/assets/js/88.9133eeba.js"><link rel="prefetch" href="/assets/js/89.6d4e53cb.js"><link rel="prefetch" href="/assets/js/9.d01dceaa.js"><link rel="prefetch" href="/assets/js/90.865b8b70.js"><link rel="prefetch" href="/assets/js/91.18aafcc1.js"><link rel="prefetch" href="/assets/js/92.cf3382cb.js"><link rel="prefetch" href="/assets/js/93.b6003c1b.js"><link rel="prefetch" href="/assets/js/94.84d5e718.js"><link rel="prefetch" href="/assets/js/95.eb85deaa.js"><link rel="prefetch" href="/assets/js/96.568ffb46.js"><link rel="prefetch" href="/assets/js/97.8b1d193f.js"><link rel="prefetch" href="/assets/js/98.c7ac97e9.js"><link rel="prefetch" href="/assets/js/99.5dc9efbf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8d92be3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">weigao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">Algorithm</a></div><div class="nav-item"><a href="/commits/" class="nav-link">Commits</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">Algorithm</a></div><div class="nav-item"><a href="/commits/" class="nav-link">Commits</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Flask</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/Backend/flask.html#reference" class="sidebar-link">Reference</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/Backend/flask.html#socketio" class="sidebar-link">SocketIO</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/Backend/flask.html#flask-structure" class="sidebar-link">Flask Structure</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/Backend/flask.html#blueprint" class="sidebar-link">Blueprint</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/Backend/flask.html#virtual-environment" class="sidebar-link">Virtual environment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/Backend/flask.html#installation" class="sidebar-link">installation</a></li><li class="sidebar-sub-header"><a href="/blog/Backend/flask.html#usage" class="sidebar-link">usage</a></li></ul></li><li><a href="/blog/Backend/flask.html#requirement-txt" class="sidebar-link">requirement.txt</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/Backend/flask.html#pipenv" class="sidebar-link">pipenv</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/Backend/flask.html#video-streaming-with-flask" class="sidebar-link">Video Streaming with Flask</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/Backend/flask.html#flask-script" class="sidebar-link">Flask Script</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/Backend/flask.html#web-server" class="sidebar-link">Web Server</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/Backend/flask.html#wsgi" class="sidebar-link">WSGI</a></li><li class="sidebar-sub-header"><a href="/blog/Backend/flask.html#nginx" class="sidebar-link">Nginx</a></li></ul></li><li><a href="/blog/Backend/flask.html#django" class="sidebar-link">Django</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/Backend/flask.html#installation-2" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/blog/Backend/flask.html#establish-application" class="sidebar-link">Establish application</a></li></ul></li><li><a href="/blog/Backend/flask.html#new-words" class="sidebar-link">New Words</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="flask"><a href="#flask" aria-hidden="true" class="header-anchor">#</a> Flask</h1> <p><a href="#socketio">How to build socketio in Flask project : socketio</a></p> <p>Flask <strong>variable, <a href="#blueprint">blueprint</a></strong> and install from <strong><a href="#requirement.txt">requirement.txt</a></strong>, some basic knowledge about <strong>WSGI, Nginx and Django</strong>.</p> <h2 id="reference"><a href="#reference" aria-hidden="true" class="header-anchor">#</a> Reference</h2> <table><thead><tr><th>NAME</th> <th>URL</th> <th>DESCRIPTION</th></tr></thead> <tbody><tr><td>flask_socketio</td> <td><a href="https://github.com/miguelgrinberg/flack" target="_blank" rel="noopener noreferrer">https://github.com/miguelgrinberg/flack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>a project using <code>flask_socketio</code></td></tr> <tr><td></td> <td>https://flask-socketio.readthedocs.io/en/latest/</td> <td><code>flask_socketio</code> official tutorial</td></tr> <tr><td>blueprint</td> <td>http://flask.pocoo.org/docs/1.0/blueprints/</td> <td><a href="http://flask.pocoo.org/docs/1.0/blueprints/" target="_blank" rel="noopener noreferrer">official tutorial<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr></tbody></table> <h2 id="socketio"><a href="#socketio" aria-hidden="true" class="header-anchor">#</a> SocketIO</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>pip <span class="token function">install</span> flask-socketio
</code></pre></div><h2 id="flask-structure"><a href="#flask-structure" aria-hidden="true" class="header-anchor">#</a> Flask Structure</h2> <p><strong>application context and request context</strong>：</p> <table><thead><tr><th>variable</th> <th>context</th> <th>description</th></tr></thead> <tbody><tr><td><code>current_app</code></td> <td>application context</td> <td>The application instance for the active application.</td></tr> <tr><td><code>g</code></td> <td>ac</td> <td></td></tr> <tr><td><code>request</code></td> <td>request context</td> <td></td></tr> <tr><td><code>session</code></td> <td>rc</td> <td></td></tr></tbody></table> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> current_app
</code></pre></div><p><a href="http://flask.pocoo.org/docs/1.0/api/#flask.g" target="_blank" rel="noopener noreferrer"><code>g</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is a special object that is unique for each request. It is used to store data that might be accessed by multiple functions during the request. The connection is stored and reused instead of creating a new connection if <code>get_db</code> is called a second time in the same request.</p> <h2 id="blueprint"><a href="#blueprint" aria-hidden="true" class="header-anchor">#</a> Blueprint</h2> <p><a href="http://flask.pocoo.org/docs/1.0/blueprints/" target="_blank" rel="noopener noreferrer">Tutorial : Modular Applications with Blueprints<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>We use the <code>create_app()</code> so that the application is created at runtime.</p> <p>A blueprint is similar to an application in that it can also define routes. The difference is that routes associated with a blueprint are in a dormant state until the blueprint is registered with an application, at which point the routes become part of it.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># app/main/__init__.py</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint
main <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">,</span> __name__<span class="token punctuation">)</span>
</code></pre></div><p>The constructor for this class takes two required arguments: <strong>the blueprint name</strong> and <strong>the model or package where the blueprint is located</strong>(always default <code>__name__</code>).</p> <h2 id="virtual-environment"><a href="#virtual-environment" aria-hidden="true" class="header-anchor">#</a> Virtual environment</h2> <h3 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> installation</h3> <p>Take Linux system as example:</p> <div class="language-python extra-class"><pre class="language-python"><code>pip install virtualenv
</code></pre></div><h3 id="usage"><a href="#usage" aria-hidden="true" class="header-anchor">#</a> usage</h3> <div class="language-python extra-class"><pre class="language-python"><code>cd <span class="token punctuation">[</span>project directory<span class="token punctuation">]</span>
virtualenv venv
</code></pre></div><p>该命令执行后，将在当前目录中建立一个venv目录，该目录复制了一份完整的当前系统的python环境。之后运行python时可以直接运行该项目的bin文件夹中的命令。</p> <p>例：在当前虚环境下安装Tornado组件：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">.</span><span class="token operator">/</span>venv<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>pip install tornado
</code></pre></div><p>或者在该虚环境中运行python程序：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">.</span><span class="token operator">/</span>venv<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>python xxxx<span class="token punctuation">.</span>py
</code></pre></div><p>也可以使用<code>activate</code>命令启动虚环境，之后不必再显示地调用虚环境bin文件夹中的命令：</p> <div class="language-python extra-class"><pre class="language-python"><code>source <span class="token punctuation">.</span><span class="token operator">/</span>venv<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>activate
</code></pre></div><p>退出虚拟环境使用<code>deactive</code>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">(</span>venv<span class="token punctuation">)</span> xxx<span class="token punctuation">:</span><span class="token operator">~</span><span class="token operator">/</span>xxx$ deactivate
</code></pre></div><h2 id="requirement-txt"><a href="#requirement-txt" aria-hidden="true" class="header-anchor">#</a> requirement.txt</h2> <p>Install from <code>requirement.txt</code>:</p> <div class="language-python extra-class"><pre class="language-python"><code>pip install <span class="token operator">-</span>r requirements<span class="token punctuation">.</span>txt
</code></pre></div><p>generate a <code>requirement.txt</code> from current project:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pip freeze <span class="token operator">&gt;</span> requirement.txt
</code></pre></div><h2 id="pipenv"><a href="#pipenv" aria-hidden="true" class="header-anchor">#</a> pipenv</h2> <p>目前流行的取代 virtual envirment 的方式就是 <a href="https://pipenv.readthedocs.io/en/latest/install/" target="_blank" rel="noopener noreferrer">pipenv<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Install pipenv:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pip <span class="token function">install</span> pipenv

pipenv shell

pipenv <span class="token function">install</span> package-name

<span class="token comment"># if you want lock the environment</span>
pipenv lock
</code></pre></div><p>退出可以使用 <code>exit</code> 或者 <code>Ctrl+D</code>.</p> <h2 id="video-streaming-with-flask"><a href="#video-streaming-with-flask" aria-hidden="true" class="header-anchor">#</a> Video Streaming with Flask</h2> <h2 id="flask-script"><a href="#flask-script" aria-hidden="true" class="header-anchor">#</a> Flask Script</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># manage.py</span>
<span class="token keyword">import</span> os
<span class="token keyword">from</span> app <span class="token keyword">import</span> create_app<span class="token punctuation">,</span> db
<span class="token keyword">from</span> app<span class="token punctuation">.</span>models <span class="token keyword">import</span> User<span class="token punctuation">,</span> Role
<span class="token keyword">from</span> flask<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>script <span class="token keyword">import</span> Manager<span class="token punctuation">,</span> Shell
<span class="token keyword">from</span> flask<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>migrate <span class="token keyword">import</span> Migrate<span class="token punctuation">,</span> MigrateCommand

app <span class="token operator">=</span> create_app<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'FLASK_CONFIG'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">'default'</span><span class="token punctuation">)</span>
manager <span class="token operator">=</span> Manager<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
migrate <span class="token operator">=</span> Migrate<span class="token punctuation">(</span>app<span class="token punctuation">,</span> db<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">make_shell_context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>app<span class="token operator">=</span>app<span class="token punctuation">,</span> db<span class="token operator">=</span>db<span class="token punctuation">,</span> User<span class="token operator">=</span>User<span class="token punctuation">,</span> Role<span class="token operator">=</span>Role<span class="token punctuation">)</span>

manager<span class="token punctuation">.</span>add_command<span class="token punctuation">(</span><span class="token string">&quot;shell&quot;</span><span class="token punctuation">,</span> Shell<span class="token punctuation">(</span>make_context<span class="token operator">=</span>make_shell_context<span class="token punctuation">)</span><span class="token punctuation">)</span>
manager<span class="token punctuation">.</span>add_command<span class="token punctuation">(</span><span class="token string">'db'</span><span class="token punctuation">,</span> MigrateCommand<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    manager<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="web-server"><a href="#web-server" aria-hidden="true" class="header-anchor">#</a> Web Server</h2> <p>目前主流的Web服务器包括<strong>Nginx, Apache, lighthttpd, IIS, etc..</strong>，Python服务端程序在Linux平台下使用最广泛的是Nginx。</p> <h3 id="wsgi"><a href="#wsgi" aria-hidden="true" class="header-anchor">#</a> WSGI</h3> <p>Web Server Gateway Interface[^2], 为Python语言定义Web服务器和服务端程序的通用接口规范。</p> <p>[^2]: <a href="https://en.wikipedia.org/wiki/Web_Server_Gateway_Interface" target="_blank" rel="noopener noreferrer">WSGI, wiki<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="nginx"><a href="#nginx" aria-hidden="true" class="header-anchor">#</a> Nginx</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> nginx
<span class="token function">sudo</span> <span class="token function">service</span> nginx start/status/stop/restart
</code></pre></div><h2 id="django"><a href="#django" aria-hidden="true" class="header-anchor">#</a> Django</h2> <h3 id="installation-2"><a href="#installation-2" aria-hidden="true" class="header-anchor">#</a> Installation</h3> <div class="language-python extra-class"><pre class="language-python"><code>pip3 install django
</code></pre></div><p>测试是否安装成功：</p> <div class="language-python extra-class"><pre class="language-python"><code>python3
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> django
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>django<span class="token punctuation">.</span>VERSION<span class="token punctuation">)</span>
</code></pre></div><h3 id="establish-application"><a href="#establish-application" aria-hidden="true" class="header-anchor">#</a> Establish application</h3> <p>建立项目：</p> <div class="language-python extra-class"><pre class="language-python"><code>django<span class="token operator">-</span>admin startproject <span class="token punctuation">[</span>project<span class="token operator">-</span>name<span class="token punctuation">]</span>
</code></pre></div><p>建立应用：</p> <div class="language-python extra-class"><pre class="language-python"><code>python manage<span class="token punctuation">.</span>py startapp <span class="token punctuation">[</span>app<span class="token operator">-</span>name<span class="token punctuation">]</span>
</code></pre></div><p>例如，在当前目录中创建一个项目<em>my_project</em>, 并且拥有特定的目录结构：</p> <div class="language-python extra-class"><pre class="language-python"><code>djangp<span class="token operator">-</span>admin startproject my_project
cd my_project
python3 manage<span class="token punctuation">.</span>py startapp my_app
</code></pre></div><p>完成之后目录结构类似于：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>my_project/
	manage.py
	my_project/
		__init__.py
		settings.py
		urls.py
		wsgi.py
	my_app/
		__init__.py
		admin.py
		apps.py
		migrations/
			__init__.py
		models.py
		tests.py
		views.py
</code></pre></div><p>内置web服务器运行：</p> <div class="language-python extra-class"><pre class="language-python"><code>python manage<span class="token punctuation">.</span>py runserver <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token number">8001</span>
</code></pre></div><p>生成数据移植文件：</p> <div class="language-python extra-class"><pre class="language-python"><code>python manage<span class="token punctuation">.</span>py makemigrations app
</code></pre></div><p>移植到数据库：</p> <div class="language-python extra-class"><pre class="language-python"><code>python manage<span class="token punctuation">.</span>py migrate
</code></pre></div><h2 id="new-words"><a href="#new-words" aria-hidden="true" class="header-anchor">#</a> New Words</h2> <table><thead><tr><th style="text-align:center;">words</th> <th style="text-align:center;">means</th></tr></thead> <tbody><tr><td style="text-align:center;">PK</td> <td style="text-align:center;">primary key</td></tr> <tr><td style="text-align:center;">FK</td> <td style="text-align:center;">foregin key</td></tr> <tr><td style="text-align:center;">CRUD</td> <td style="text-align:center;">create, retrieve, update and delete</td></tr></tbody></table></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/28/2019, 5:57:40 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.5b882d21.js" defer></script><script src="/assets/js/5.cd1db3e5.js" defer></script><script src="/assets/js/57.81a8354f.js" defer></script><script src="/assets/js/23.2c687b63.js" defer></script>
  </body>
</html>
